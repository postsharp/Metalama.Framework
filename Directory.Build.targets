<Project>

    <Import Sdk="PostSharp.Engineering.Sdk" Project="AssemblyMetadata.targets"/>
    <Import Sdk="PostSharp.Engineering.Sdk" Project="TeamCity.targets"/>
    <Import Sdk="PostSharp.Engineering.Sdk" Project="CleanXmlDoc.targets"
            Condition="'$(EngineeringConfiguration)'=='Public'"/>

    <ItemGroup>
        <!-- Specifically use the same version of Roslyn as we're using in Metalama Compiler -->
        <PackageReference Include="Microsoft.Net.Compilers.Toolset" Version="$(RoslynVersion)"
                          Condition="'$(UseMetalamaCompiler)'==''">
            <PrivateAssets>all</PrivateAssets>
            <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
        </PackageReference>
        <PackageReference Include="Metalama.Compiler" Version="$(MetalamaCompilerVersion)" PrivateAssets="all"
                          Condition="'$(UseMetalamaCompiler)'=='Private'"/>
        <PackageReference Include="Metalama.Compiler" Version="$(MetalamaCompilerVersion)"
                          Condition="'$(UseMetalamaCompiler)'=='Public'"/>
    </ItemGroup>

    <PropertyGroup>
        <!-- When debugging the release build, disable optimizations. -->
        <!-- <Optimize>False</Optimize> -->
    </PropertyGroup>



    <ItemGroup Condition="'$(ReferenceMetalamaSystemTypes)'!='False' AND '$(TargetFramework)'=='netstandard2.0'">
        <ProjectReference Include="..\Metalama.SystemTypes\Metalama.SystemTypes.csproj" ReferenceOutputAssembly="false" />
        <Reference Include="..\Metalama.SystemTypes\bin\$(Configuration)\netstandard2.0\Metalama.SystemTypes.dll" />
    </ItemGroup>

	<PropertyGroup  Condition="'$(PackMetalamaSystemTypes)'=='True' AND '$(TargetFramework)'=='netstandard2.0'">
		<TargetsForTfmSpecificBuildOutput>$(TargetsForTfmSpecificBuildOutput);MetalamaFrameworkSetLibAssembliesInPackage</TargetsForTfmSpecificBuildOutput>
	</PropertyGroup>

	<Target Name="MetalamaFrameworkSetLibAssembliesInPackage" DependsOnTargets="ResolveReferences">
		<ItemGroup>
          <TfmSpecificPackageFile Include="..\Metalama.SystemTypes\bin\$(Configuration)\netstandard2.0\Metalama.SystemTypes.dll" PackagePath="lib/netstandard2.0" />
		</ItemGroup>
	</Target>

</Project>