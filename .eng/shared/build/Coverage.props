<Project>

    <PropertyGroup Condition="'$(CollectCoverage)'=='True'">
    
        <!-- Our custom test framework is not compatible with coverlet, so we have to disable it. -->
        <CaravelaTestReplaceFramework>False</CaravelaTestReplaceFramework>
        
        <!-- This property is typically set by the calling PS script -->
        <CoverletOutput Condition="'$(CoverletOutput)'==''">$(MSBuildThisFileDirectory)\..\..\..\TestResults\</CoverletOutput>
        
        <!-- Set up merging of reports.  -->
                
        <MergeWith>$(CoverletOutput)\coverage.json</MergeWith>
        <CoverletOutputFormat>opencover,json</CoverletOutputFormat>
        <ExcludeByAttribute>Obsolete,GeneratedCode,CompilerGenerated</ExcludeByAttribute>
        
        <!-- Set up shared exclusions -->
        <Exclude>[*.Tests.*]*</Exclude>
        <SkipAutoProps>True</SkipAutoProps>
        
    </PropertyGroup>
    
    <ItemGroup>
        <PackageReference Include="coverlet.collector" Version="$(CoverletVersion)" />
        <PackageReference Include="coverlet.msbuild" Version="$(CoverletVersion)" />
    </ItemGroup>

</Project>